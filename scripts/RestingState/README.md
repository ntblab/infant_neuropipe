# Analysis pipeline for resting state 

This document outlines the analyses used to study functional connectivity in sleeping/resting and movie-watching participants. This assumes that all of the infant\_neuropipe steps have been run on the raw data. Additionally, if using a different motion threshold than the default of 3mm FD (e.g., 0.2mm), you should run `scripts/explore_motion_firstlevel.sh` in the subject folder for each specific functional run that will be used. Files used in group analyses have been aligned to standard using `scripts/align_functionals.sh` in the subject folder.

Some analyses rely on functions for intersubject correlation, which are stored at `scripts/RestingState/modified_isc.py`. This script is nearly identical to the intersubject correlation functions in [Brainiak](https://brainiak.org/docs/), with minor edits to deal with missing data in infant participants. See scripts for details.

Figures from the paper are generated in the jupyter notebook titled `scripts/RestingState/RestingState.py`. The notebook uses files that have been stored on Dryad (link to come with published manuscript), and are assumed to be stored in a folder called `data/RestingState/${Age}_${Task_name}`, where 'Age' refers to Infant vs. Adult, and 'Task\_name' refers to Rest, Sleep, Aeronaut, or Mickey. Analyses in the notebook can be replicated using these data (i.e., no other scripts need to be run if you have pulled this data). 

Most analyses are run within the main notebook on functional connectivity matrices that were created by the script `scripts/RestingState/create_connectivity_maps.py`. If you are pulling data from Dryad, these matrices are already stored in the folder `data/RestingState/${Age}_${Task_name}/connectivity_maps`. However, if you are re-running analyses from scratch, you will need to run this script again. To do so, you should be located in the main infant\_neuropipe folder, and then run the script `scripts/RestingState/run_create_connectivity_maps.sh` with the following 5 inputs: subject name (e.g., 'rest_movie\_01'), task name (e.g., 'Adult\_Rest'), nifti type signaling the amount of preprocessing that has been done (e.g., '\_fslmotion\_thr3'), parcellation (e.g., 'schaefer'), and number of parcels (e.g., '100'). 

Note that the last cells of the notebook require the package `nxviz` to be loaded into your conda environment. 
